@model List<ModuloProduccionPiscina.Models.Pedido>

@{
    ViewData["Title"] = "Pedidos";
}

<!-- TÍTULO Y BOTÓN NUEVO -->
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="text-primary mb-0">📋 Pedidos Registrados</h2>
        <a asp-action="Create" class="btn btn-success">+ Nuevo Pedido</a>
    </div>

    <!-- BÚSQUEDA -->
    <div class="input-group mb-4 w-50">
        <span class="input-group-text bg-white"><i class="bi bi-search"></i></span>
        <input type="text" id="buscarPedidos" class="form-control" placeholder="Buscar pedidos..." onkeyup="filtrarTabla()" />
    </div>

    <!-- TABLA DE PEDIDOS -->
    <div class="table-responsive">
        <table class="table table-bordered table-hover align-middle" id="tablaPedidos">
            <thead class="table-light text-center">
                <tr>
                    <th>Fecha</th>
                    <th>Piscina</th>
                    <th>Registrado por</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var pedido in Model)
                {
                    <tr>
                        <td class="text-center">@pedido.FechaConsumo.ToShortDateString()</td>
                        <td class="text-center">@pedido.Piscina?.Nombre</td>
                        <td class="text-center">@(!string.IsNullOrEmpty(pedido.UsuarioId) ? pedido.UsuarioId.Split('@')[0] : "No disponible")</td>
                        <td class="text-center">
                            <a asp-action="Details" asp-route-id="@pedido.IdPedido" class="btn btn-sm btn-outline-info me-1">Detalles</a>
                            <a asp-action="Edit" asp-route-id="@pedido.IdPedido" class="btn btn-sm btn-outline-warning me-1">Editar</a>
                            <a asp-action="Anular" asp-route-id="@pedido.IdPedido" class="btn btn-sm btn-outline-danger">Anular</a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<!-- SCRIPT DE FILTRADO -->
@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const input = document.getElementById('buscarPedidos');
            input.addEventListener('keyup', filtrarTabla);

            function filtrarTabla() {
                const valor = input.value.toLowerCase();
                const filas = document.querySelectorAll('#tablaPedidos tbody tr');
                filas.forEach(fila => {
                    const textoFila = fila.textContent.toLowerCase();
                    fila.style.display = textoFila.includes(valor) ? '' : 'none';
                });
            }
        });
    </script>
}
